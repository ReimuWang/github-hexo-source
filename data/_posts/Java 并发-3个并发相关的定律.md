---
title: Java 并发-3个并发相关的定律
date: 2017-09-29 17:45:36
tags: [Java,并发,摩尔定律,Amdahl定律,Gustafson定律]
categories: Java 并发
---

Amdahl定律及Gustafson定律主要探讨的是并发程序对性能的提升。

# 摩尔定律

<!-- more -->

摩尔定律是由英特尔(Intel)创始人之一的戈登·摩尔(Gordon Moore)所提出的。其内容为：当价格不变时，集成电路上可容纳的元器件的数目，约每隔24个月便会增加一倍，性能也将提升一倍。

经常被引用的18个月，出自英特尔首席执行官大卫·豪斯。

# Amdahl定律

![0.jpg](/images/blog_pic/Java 并发/3个并发相关的定律/0.jpg)

其中：

T1:1个CPU时的耗时。Tn：n个CPU时的耗时。F：程序中只能串行执行的比例。

首先分析F的极端情况。若F=0，即程序全部为可并行执行的代码，那么有T1=nTn，即加速比=n，即有几个CPU，程序的速度就被提升了几倍。若F=1，即程序代码全部都只能串行执行，那么有T1=Tn，即加速比=1，此时无论有多少个CPU，程序的效率都不会提升。

然后分析n的极端情况。若n=1，即只有一个CPU，那么有T1=Tn，即加速比=1，此时无论可并行执行的代码比例有多高，程序的效率都不会提升。若n=正无穷大，此时Tn=FT1，即加速比=1/F，与串行化代码的比例成反比，串行化比例越低，程序执行效率越高。

由此可得出：程序串行化代码比例越低，CPU数越多，并行执行的效率越高。

# Gustafson定律

![1.jpg](/images/blog_pic/Java 并发/3个并发相关的定律/1.jpg)

其中：

执行时间：并行程序优化后的耗时。总执行时间：未并行化前的耗时。

首先分析F的极端情况。若F=0，即程序全部为可并行执行代码，那么有加速比=n，即有几个CPU，程序的速度就被提升了几倍。若F=1，即程序代码全部都只能串行执行，那么有加速比=1，此时无论有多少个CPU，程序的效率都不会提升。

然后分析n的极端情况。若n=1，即只有一个CPU，那么有加速比=1，此时无论可并行执行的代码比例有多高，程序的效率都不会提升。若n=正无穷大，此时加速比=(1-F)n+F，若F也取极端值，即若F=1，则加速比=1；若F=0，加速比=n。至此还和预期相同，但是当F在(0,1)时，加速比依然为无穷大，只是这个无穷大受F的影响：F越大，增长越慢，但是无穷大依然还是无穷大，与预期的结果不同。

由此可得出：程序串行化代码比例越低，CPU数越多，并行执行的效率越高。

# Amdahl定律及Gustafson定律是否矛盾

本质上，两个定律描述的都是加速比，CPU数n，串行化执行代码的比例F三者之间的关系。但是二者不仅公式不同，在某些极限值情况下的结果也不同，那么二者是否矛盾？

首先需要说明的是，所谓的"在某些极限值情况下的结果也不同"其实是弱极限情况。本质上这两个公式都是在用n与F来描述加速比。而前文的极限情况都是n，F其中之一达到极限值，另一个依然是可变的。若n与F都达到极限值，那么这两个定律的结论是相同的。前文推断出的认为Gustafson定律有问题的极限情况其实只有：n达到了正无穷，F未在极限值的状态下这一种。

造成这个差异的原因是因为两个公式在看待这个问题时从一开始的出发点就不同。Amdahl定律着重强调的是F的重要性，即F一定的情况下，无论CPU数怎么折腾，程序都会有一个理论的极限值。Gustafson定律强调的是n的重要性，即当F所占比重足够少时，程序执行的效率将随n线性增长。